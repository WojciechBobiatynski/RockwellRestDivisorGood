<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pl.sodexo.it.gryf.dao.api.search.mapper.IndividualSearchMapper">

    <select id="findIndividualIdByPeselAndEmail" resultType="pl.sodexo.it.gryf.common.dto.security.individuals.VerificationDto">
        SELECT
            ind.pesel                       pesel,
            contact.contact_data            email
        FROM APP_PBE.INDIVIDUALS ind
            JOIN APP_PBE.INDIVIDUAL_CONTACTS contact ON contact.IND_ID = ind.ID
        WHERE
            contact.CONTACT_TYPE = #{criteria.config.verEmailContactType}
            AND TRIM(contact.CONTACT_DATA) = #{verification.email}
            AND TRIM(ind.PESEL) = #{verification.pesel}
    </select>

</mapper>
